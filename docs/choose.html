<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Saving your choice…</title>
  <script>
    // ===== CONFIG =====
    const owner = "{{GT_OWNER}}";  // will be replaced by Actions
    const repo = "{{GT_REPO}}";    // will be replaced by Actions
    const token = "{{GITHUB_TOKEN}}"; // will be replaced by Actions
    // ==================

    const params = new URLSearchParams(location.search);
    const choice = params.get("choice") || "1";

    async function dispatch() {
      try {
        const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/dispatches`, {
          method: "POST",
          headers: {
            "Accept": "application/vnd.github.everest-preview+json",
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            event_type: "select_post",
            client_payload: { choice }
          })
        });

        if (response.ok) {
          document.body.innerHTML = `
            <h2>✅ Got it!</h2>
            <p>Your LinkedIn post option ${choice} is being prepared.</p>`;
        } else {
          const error = await response.text();
          throw new Error(error);
        }
      } catch (err) {
        console.error("Dispatch failed:", err);
        document.body.innerHTML = `
          <h2>❌ Oops</h2>
          <p>Something went wrong. Try again or check console for details.</p>`;
      }
    }

    window.onload = dispatch;
  </script>
</head>
<body>
  <h2>Submitting your choice…</h2>
</body>
</html>
